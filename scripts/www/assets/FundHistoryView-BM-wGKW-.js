import{_ as B,h as l,o as M,a as R,w as j,b as n,c,d as e,u as g,t as i,f as v,F as P,r as O,n as I,p as K,x as Q,j as U,i as W}from"./index-CRAB7jjQ.js";import{l as $,a as q}from"./data-DyJSRnoA.js";import"./jsonpCallbackGenerator-Bt3BN9dH.js";const A={class:"fund-history"},G={class:"fixed top-0 left-0 right-0 z-50 bg-blue-50 border-b border-gray-300 shadow-sm"},X={class:"px-0 py-0"},Y={class:"flex items-center justify-between px-4 py-3"},tt={class:"text-center max-w-[140px] md:max-w-[200px] flex-1"},et={class:"text-lg font-bold text-blue-800 truncate"},st={class:"text-sm text-gray-600 truncate"},at={class:"mb-3 px-2"},ot={key:0,class:"mt-1 text-xs md:text-sm flex items-center"},lt={class:"text-blue-600 truncate"},rt={key:0,class:"text-center py-8"},nt={key:1,class:"bg-white rounded-lg overflow-hidden card-shadow"},ct={class:"overflow-x-auto"},dt={class:"w-full"},ut={class:"py-3 px-2 md:px-4 text-xs md:text-sm"},it={class:"py-3 px-2 md:px-4 text-xs md:text-sm font-medium"},xt={class:"py-3 px-2 md:px-4 text-xs md:text-sm font-medium"},pt={class:"py-3 px-2 md:px-4"},vt={key:0},ft={key:0,class:"border-t border-gray-200"},mt={key:1,class:"border-t border-gray-200 py-3 text-center"},yt={key:2,class:"border-t border-gray-200 py-3 text-center"},gt=100,ht={__name:"FundHistoryView",setup(bt){const w=Q(),T=U(),_=w.params.code,L=l(w.params.name),h=l(!0),x=l(!1),p=l([]),f=l(null),k=l(!1),d=l(""),H=l("date"),S=l("desc"),m=l(1),D=l(20),V=l(0),u=l(!0),Z=W(()=>{let s=[...p.value];return d.value&&(s=s.filter(t=>t.date===d.value)),s.sort((t,a)=>{let o,r;switch(H.value){case"date":o=new Date(t.date),r=new Date(a.date);break;case"nav":o=parseFloat(t.nav),r=parseFloat(a.nav);break;case"accumulatedNav":o=parseFloat(t.accumulatedNav),r=parseFloat(a.accumulatedNav);break;case"change":o=parseFloat(t.change),r=parseFloat(a.change);break;default:return 0}return S.value==="asc"?o>r?1:o<r?-1:0:o<r?1:o>r?-1:0}),s}),E=s=>s||"",J=s=>s==null||isNaN(s)?"text-gray-600":parseFloat(s)>=0?"text-red-500":"text-green-500",b=async(s=1,t=!1)=>{try{t?x.value=!0:(h.value=!0,m.value=s);const o=(await q(_,s,D.value)).data;if(o.ErrCode===0){const r=o.Data.LSJZList.map(y=>({date:y.FSRQ,nav:y.DWJZ,accumulatedNav:y.LJJZ,change:y.JZZZL}));t?p.value.push(...r):(p.value=r,V.value=o.TotalCount||o.Data.LSJZList.length),u.value=r.length>=D.value,t&&(m.value=s)}}catch(a){console.error("加载历史数据失败:",a),u.value=!1}finally{h.value=!1,x.value=!1}},F=async()=>{if(x.value||!u.value)return;const s=m.value+1;await b(s,!0)},C=$.debounce(()=>{if(!f.value||x.value||!u.value)return;const s=f.value,t=s.scrollTop,a=s.clientHeight,o=s.scrollHeight;k.value=t>200,o-t-a<=gt&&F()},100),z=()=>{f.value&&f.value.scrollTo({top:0,behavior:"smooth"})},N=()=>{d.value=""};return M(async()=>{await b(1);const s=t=>{t.key==="Escape"&&d.value&&N(),t.key===" "&&t.target===document.body&&(t.preventDefault(),toggleSortOrder())};window.addEventListener("keydown",s),R(()=>{window.removeEventListener("keydown",s)})}),j(d,()=>{m.value=1,u.value=!0,b(1)}),(s,t)=>(n(),c("div",A,[e("header",G,[e("div",X,[e("div",Y,[e("button",{onClick:t[0]||(t[0]=a=>g(T).back()),class:"flex items-center space-x-2 text-blue-700"},[...t[2]||(t[2]=[e("i",{class:"fa fa-arrow-left text-xl"},null,-1),e("span",{class:"text-sm font-semibold"},"返回",-1)])]),e("div",tt,[e("h2",et,i(L.value),1),e("p",st,i(g(_)),1)]),t[3]||(t[3]=e("div",{class:"w-16"},null,-1))])])]),e("main",{ref_key:"scrollContainer",ref:f,class:"px-2 md:px-4 py-4 pt-16",onScroll:t[1]||(t[1]=(...a)=>g(C)&&g(C)(...a))},[e("div",at,[d.value?(n(),c("div",ot,[e("span",lt,"筛选: "+i(d.value),1),e("button",{onClick:N,class:"ml-2 px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200 whitespace-nowrap"},"清除 ")])):v("",!0)]),h.value?(n(),c("div",rt,[...t[4]||(t[4]=[e("i",{class:"fa fa-spinner fa-spin text-xl md:text-2xl text-blue-600"},null,-1),e("p",{class:"mt-2 text-sm md:text-base text-gray-600"},"加载中...",-1)])])):(n(),c("div",nt,[e("div",ct,[e("table",dt,[t[6]||(t[6]=e("thead",{class:"sticky top-0 bg-white z-10"},[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"text-left py-3 px-2 md:px-4 text-sm font-medium text-gray-700"},"日期"),e("th",{class:"text-left py-3 px-2 md:px-4 text-sm font-medium text-gray-700"},"单位净值"),e("th",{class:"text-left py-3 px-2 md:px-4 text-sm font-medium text-gray-700"},"累计净值"),e("th",{class:"text-left py-3 px-2 md:px-4 text-sm font-medium text-gray-700"},"日涨跌幅")])],-1)),e("tbody",null,[(n(!0),c(P,null,O(Z.value,a=>(n(),c("tr",{key:a.date,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors"},[e("td",ut,i(E(a.date)),1),e("td",it,i(a.nav),1),e("td",xt,i(a.accumulatedNav),1),e("td",pt,[e("span",{class:I(["text-xs md:text-sm font-medium",J(a.change)])},i((parseFloat(a.change)>0?"+":"")+a.change+"%"),3)])]))),128)),p.value.length===0?(n(),c("tr",vt,[...t[5]||(t[5]=[e("td",{colspan:"4",class:"py-8 text-center"},[e("div",{class:"text-gray-400"},[e("i",{class:"fa fa-exclamation-circle text-xl mb-2"}),e("p",{class:"text-sm"},"暂无历史数据")])],-1)])])):v("",!0)])])]),!x.value&&u.value&&p.value.length>0?(n(),c("div",ft,[e("button",{onClick:F,class:"w-full py-3 text-sm text-blue-600 hover:text-blue-800 hover:bg-gray-50 transition-colors flex items-center justify-center"},[...t[7]||(t[7]=[e("i",{class:"fa fa-arrow-down mr-2"},null,-1),K(" 加载更多 ",-1)])])])):v("",!0),x.value?(n(),c("div",mt,[...t[8]||(t[8]=[e("i",{class:"fa fa-spinner fa-spin text-blue-600 mr-2"},null,-1),e("span",{class:"text-sm text-gray-600"},"正在加载更多...",-1)])])):v("",!0),!u.value&&p.value.length>0?(n(),c("div",yt,[...t[9]||(t[9]=[e("div",{class:"text-gray-400"},[e("i",{class:"fa fa-check-circle mr-2"}),e("span",{class:"text-sm"},"已加载全部数据")],-1)])])):v("",!0)])),k.value?(n(),c("button",{key:2,onClick:z,class:"fixed bottom-6 right-6 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all z-50"},[...t[10]||(t[10]=[e("i",{class:"fa fa-arrow-up"},null,-1)])])):v("",!0)],544)]))}},Dt=B(ht,[["__scopeId","data-v-9ef77f32"]]);export{Dt as default};
