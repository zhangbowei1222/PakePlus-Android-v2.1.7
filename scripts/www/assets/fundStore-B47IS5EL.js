import{z as k,h,i as y}from"./index-CRAB7jjQ.js";import{a as D,c as N}from"./jsonpCallbackGenerator-Bt3BN9dH.js";D.create({adapter:N,baseURL:"",timeout:1e4,headers:{"Content-Type":"application/json"}});const P=await generateJsonpCallback(),w={async request(a,e={}){return new Promise((d,r)=>{const n=`jsonp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=document.createElement("script"),c=new URLSearchParams({...e,callback:n});o.src=`${a}?${c.toString()}`,window[n]=u=>{delete window[n],document.head.removeChild(o),d(u)},o.onerror=()=>{delete window[n],document.head.removeChild(o),r(new Error("JSONP请求失败"))};const s=setTimeout(()=>{delete window[n],document.head.removeChild(o),r(new Error("JSONP请求超时"))},1e4),l=window[n];window[n]=function(u){clearTimeout(s),l(u)},document.head.appendChild(o)})},async eastmoneyJsonp(a,e){const d=Date.now(),r=Math.random().toString().substr(2,12),n=`jQuery${d}_${r}`;return new Promise((o,c)=>{const s=document.createElement("script"),l=new URLSearchParams({...e,cb:n});s.src=`${a}?${l.toString()}`,window[n]=m=>{delete window[n],document.head.removeChild(s),o(m)},s.onerror=()=>{delete window[n],document.head.removeChild(s),c(new Error("东方财富API请求失败"))};const u=setTimeout(()=>{delete window[n],document.head.removeChild(s),c(new Error("东方财富API请求超时"))},1e4),p=window[n];window[n]=function(m){clearTimeout(u),p(m)},document.head.appendChild(s)})},async req(a,e={}){if(e.callback||a.includes("callback=")){const r=e.callback||"jsonp_callback_"+Math.random().toString(36).substr(2);return new Promise((n,o)=>{const c=document.createElement("script");let s="";for(const l in e)l!=="callback"&&(s+=`&${l}=${encodeURIComponent(e[l])}`);s+=`&callback=${r}`,c.src=a+"?"+s.substring(1),window[r]=function(l){delete window[r],document.body.removeChild(c),n(l)},c.onerror=function(){delete window[r],document.body.removeChild(c),o(new Error("JSONP请求失败"))},document.body.appendChild(c)})}else return new Promise((r,n)=>{const o=document.createElement("script");let c="";for(const s in e)c+=`&${s}=${encodeURIComponent(e[s])}`;o.src=a+(c?"?"+c.substring(1):""),o.onload=function(){console.log("Script加载完成，等待数据提取..."),setTimeout(()=>{try{if(window.apidata){const s=window.apidata;console.log("数据提取完成，返回数据...",s),delete window.content,document.body.removeChild(o),r(s)}else document.body.removeChild(o),r(null)}catch(s){document.body.removeChild(o),n(s)}},500)},o.onerror=function(){document.body.removeChild(o),n(new Error("Script加载失败"))},document.body.appendChild(o)})}},$={async searchFund(a){return w.request("https://fundsuggest.eastmoney.com/FundSearch/api/FundSearchAPI.ashx",{m:1,key:a,_:Date.now().toString().substring(0,10)})},async getFundNetValue(a,e=1,d=10){return w.request("https://api.fund.eastmoney.com/f10/lsjz",{callback:P,fundCode:a,pageIndex:e,pageSize:d,startDate:"",endDate:"",_:Date.now().toString().substring(0,10)})},async getFundHoldings(a){return w.req("https://fundf10.eastmoney.com/FundArchivesDatas.aspx",{type:"jjcc",code:a,topline:10,year:"",month:"",rt:Math.random()})},async getStockData(a){try{return await this.eastmoneyJsonp("https://push2.eastmoney.com/api/qt/ulist.np/get",{invt:2,fltt:2,fields:"f2,f3,f12,f14,f9,f100",ut:"267f9ad526dbe6b0262ab19316f5a25b",secids:a,_:Date.now().toString().substring(0,10)})}catch(e){return console.error("获取股票数据失败:",e),null}},async getFundInfo(a){try{const e="https://api.allorigins.win/raw?url=",d=`https://fundf10.eastmoney.com/jbgk_${a}.html?_=${Date.now()}`,r=await fetch(e+encodeURIComponent(d),{headers:{Accept:"text/html","User-Agent":"Mozilla/5.0"}});if(r.ok){const n=await r.text();return this.extractFundInfo(n)}return null}catch(e){return console.error("获取基金信息失败:",e),null}},extractFundInfo(a){const e={type:"",establishDate:"",scale:"",company:"",manager:"",hosting:""};return Object.entries({type:/<th[^>]*>基金类型<\/th>\s*<td[^>]*>([^<]+)/,establishDate:/<th[^>]*>成立日期[^<]*<\/th>\s*<td[^>]*>([^<]+)/,scale:/<th[^>]*>净资产规模<\/th>\s*<td[^>]*>([^<]+)/,company:/<th[^>]*>基金管理人<\/th>\s*<td[^>]*>[^<]*<a[^>]*>([^<]+)/,manager:/<th[^>]*>基金经理人<\/th>\s*<td[^>]*>[^<]*<a[^>]*>([^<]+)/,hosting:/<th[^>]*>基金托管人<\/th>\s*<td[^>]*>[^<]*<a[^>]*>([^<]+)/}).forEach(([r,n])=>{const o=a.match(n);if(o&&o[1]){let c=o[1].trim();r==="establishDate"&&(c=this.formatChineseDate(c)),e[r]=c}}),e},formatChineseDate(a){if(!a)return"";a=a.split(" / ")[0];const e=a.match(/(\d{4})年(\d{1,2})月(\d{1,2})日/);if(e){const d=e[1],r=e[2].padStart(2,"0"),n=e[3].padStart(2,"0");return`${d}-${r}-${n}`}return a}},A=k("fund",()=>{const a=h([]),e=h([]),d=h([]),r=h([]),n=h([]),o={holdFunds:[],marketIndices:[{name:"上证指数",value:3245.86,change:.82,trend:[3220,3225,3218,3230,3228,3235,3240,3238,3242,3245]},{name:"深证成指",value:10533.68,change:1.05,trend:[10480,10490,10475,10500,10510,10505,10520,10515,10530,10533]},{name:"创业板指",value:2128.97,change:-.23,trend:[2135,2130,2128,2132,2130,2125,2127,2129,2127,2128]}],favoriteFunds:[{code:"005918",name:"易方达均衡精选混合",estimateNav:1.6842,yesterdayNav:1.653,change:1.86},{code:"161725",name:"招商中证白酒指数",estimateNav:1.4258,yesterdayNav:1.401,change:2.45},{code:"003095",name:"中欧医疗健康混合A",estimateNav:2.458,yesterdayNav:2.402,change:2.33}]},c=y(()=>a.value.reduce((t,i)=>t+(i.dayProfit||0),0).toFixed(2)),s=y(()=>a.value.reduce((t,i)=>t+(i.holdAmount||0),0).toFixed(2)),l=y(()=>a.value.reduce((t,i)=>t+(i.holdProfit||0),0).toFixed(2)),u=()=>{a.value.length===0&&(a.value=o.holdFunds),e.value.length===0&&(e.value=o.favoriteFunds||[]),d.value.length===0&&(d.value=o.marketIndices)},p=async t=>{if(!t){n.value=[];return}try{const i=await $.searchFund(t);i.Datas&&(n.value=i.Datas.map(v=>({code:v.CODE,name:v.NAME,type:v.TYPE})))}catch(i){console.error("搜索基金失败:",i),n.value=[]}},m=t=>{if(f(t.code)){alert("该基金已在自选列表中！");return}e.value.push({code:t.code,name:t.name,estimateNav:(1+Math.random()*.5).toFixed(4),yesterdayNav:(1+Math.random()*.5-.1).toFixed(4),change:(Math.random()-.4)*3}),alert("添加自选成功！")},g=t=>{e.value=e.value.filter(i=>i.code!==t)},b=()=>{confirm("确定清空自选基金？")&&(e.value=[])},f=t=>e.value.some(i=>i.code===t),F=()=>{a.value.forEach(t=>{t.change=(Math.random()-.4)*3,t.changeValue=t.change/100*t.yesterdayNav,t.estimateNav=t.yesterdayNav+t.changeValue,t.dayProfit=t.changeValue*t.holdShare,t.holdProfit=(t.estimateNav-t.costPrice)*t.holdShare,t.holdAmount=t.estimateNav*t.holdShare}),alert("数据已刷新！")},C=t=>{a.value.push(t)},S=()=>{confirm("确定重置所有本地数据？")&&(a.value=[],e.value=[],d.value=[],r.value=[],n.value=[],location.reload())};return u(),{holdFunds:a,favoriteFunds:e,marketIndices:d,searchResults:n,totalProfit:c,totalAssets:s,totalEarnings:l,searchFunds:p,addToFavorites:m,removeFromFavorites:g,clearFavorites:b,isFavorite:f,refreshHoldData:F,resetData:S,addHoldFund:C}},{persist:{key:"fundStore",paths:["holdFunds","favoriteFunds"]}});export{A as u};
